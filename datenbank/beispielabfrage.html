<html>
  <body>
    <table>
      <tr>
        <td id="ergebnis-1"></td>
        <td id="ergebnis-2"></td>
      </tr>
    </table>
    <script>
      'use strict'

      // Beispiel einer Datenbankabfrage via GraphQL von einer externen Website aus.

      // GraphQL-Beispielabfrage
      // Alle Modultitel und Links zu den Quellen im Lehrplanverzeichnis
      // für Deutsch in der fünften Klasse, die einen Titel haben.
      const beispielabfrage = `
        {
          lehrplan(
            where: {
              fach: {_eq: "Deutsch"},
              klassenstufe: {_eq: "4"},
              lehrplandetail: {
                titel: {_neq: ""}
              },
              schulart_intern: {_eq: "Grundschule"}
            }
          )
          {
            lehrplandetail {
              beschreibung
              hierarchie
              quelle
              titel
            }
          }
        }`

      const success = id => data => {
        document.getElementById(id).innerHTML = data.data.lehrplan
          .map(
            a => `
                <li>
                  ${a.lehrplandetail.hierarchie}
                  <a href="${a.lehrplandetail.quelle}">
                    ${a.lehrplandetail.titel}
                  </a>
                </li>
                <p>${a.lehrplandetail.beschreibung}</p>`
          )
          .join('<br />')
      }

      // Funktion, um generelle Abfragen per POST-Methode durchzuführen
      const postFetch = (url, data, success) =>
        fetch(url, {
          method: 'POST',
          cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
          headers: {
            'Content-Type': 'application/json',
            Accept: 'application/json'
          },
          body: JSON.stringify({ query: data })
        })

      postFetch(
        'https://lernplattform-graphql.herokuapp.com/v1/graphql',
        beispielabfrage
      )
        .then(response => response.json())
        .then(data => success('ergebnis-2')(data))
        .catch(error => console.warn(error))

      // Alternative Methode
      // Angepasst aus: https://plainjs.com/javascript/ajax/send-ajax-get-and-post-requests-47/
      const postAjax = (url, data, success) => {
        var xhr = new XMLHttpRequest()
        xhr.open('POST', url)
        xhr.onreadystatechange = function () {
          if (xhr.readyState > 3 && xhr.status == 200) {
            success(JSON.parse(xhr.responseText))
          }
        }
        xhr.send(JSON.stringify({ query: data }))
        return xhr
      }

      postAjax(
        'https://lernplattform-graphql.herokuapp.com/v1/graphql',
        beispielabfrage,
        success('ergebnis-1')
      )
    </script>
  </body>
</html>
